-- Pixel Blade OP Hub (Minimal GUI) - Pablo Henricke 2026
-- Fixes: No spam farm | GUI Toggles | OP All Modes | Dodge/Parry | Auto Ability | Fly
-- F1: Toggle Panel | Load no lobby OK

local player = game.Players.LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local uis = game:GetService("UserInputService")
local run = game:GetService("RunService")
local ts = game:GetService("TweenService")

local gui = Instance.new("ScreenGui")
gui.Name = "PabloOP"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

local toggles = {
    god = true,
    aura = true,
    farm = false,  -- OFF by default (anti-spam)
    ability = true,
    dodge = true,
    fly = false,
    speed = true
}

local stats = {kills = 0, farms = 0}
local farmCooldown = {}
local rootPart, humanoid
local flyVel = nil
local panelVisible = true

local function getChar()
    local char = player.Character
    if char then
        rootPart = char:FindFirstChild("HumanoidRootPart")
        humanoid = char:FindFirstChild("Humanoid")
        return char
    end
end

local function log(msg)
    print("[Pablo OP] " .. msg)
end

-- GUI Minimal
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 250, 0, 350)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
title.Text = "Pablo OP Hub"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.Parent = mainFrame

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.TextScaled = true
closeBtn.Font = Enum.Font.Gotham
closeBtn.Parent = mainFrame

-- Toggle buttons
local function createToggle(name, yPos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, yPos)
    btn.BackgroundColor3 = toggles[name] and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
    btn.Text = name:upper() .. ": " .. (toggles[name] and "ON" or "OFF")
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextScaled = true
    btn.Font = Enum.Font.Gotham
    btn.BorderSizePixel = 0
    btn.Parent = mainFrame
    btn.MouseButton1Click:Connect(function()
        toggles[name] = not toggles[name]
        btn.BackgroundColor3 = toggles[name] and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
        btn.Text = name:upper() .. ": " .. (toggles[name] and "ON" or "OFF")
    end)
    return btn
end

createToggle("god", 50)
createToggle("aura", 90)
createToggle("farm", 130)
createToggle("ability", 170)
createToggle("dodge", 210)
createToggle("fly", 250)
createToggle("speed", 290)

-- Drag
local dragging, dragStart, startPos
title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)
uis.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
uis.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

closeBtn.MouseButton1Click:Connect(function()
    panelVisible = not panelVisible
    mainFrame.Visible = panelVisible
end)

-- Functions
local function applyGod()
    local char = getChar()
    if not char or not humanoid then return end
    if toggles.god then
        humanoid.MaxHealth = math.huge
        humanoid.Health = math.huge
    end
    if toggles.speed then
        humanoid.WalkSpeed = 100
        humanoid.JumpPower = 120
        humanoid.JumpHeight = 50
    end
end

local function killAura()
    if not toggles.aura then return end
    local char = getChar()
    if not char or not rootPart then return end
    for _, obj in pairs(workspace:GetChildren()) do
        local hum = obj:FindFirstChild("Humanoid")
        local hrp = obj:FindFirstChild("HumanoidRootPart") or obj.PrimaryPart
        if hum and hrp and hum.Health > 0 and obj ~= char then
            local dist = (rootPart.Position - hrp.Position).Magnitude
            if dist <= 55 then
                pcall(function()
                    rs.remotes.useAbility:FireServer("tornado")
                    rs.remotes.abilityHit:FireServer(hum, math.huge, {stun = {dur = math.huge}})
                end)
                stats.kills += 1
            end
        end
    end
end

local function autoFarm()
    if not toggles.farm then return end
    -- Smart: Only nearby prompts, cooldown 2s per prompt
    for _, p in pairs(workspace:GetDescendants()) do
        if p:IsA("ProximityPrompt") and p.Enabled and rootPart then
            local dist = (rootPart.Position - p.Parent.Position).Magnitude
            if dist <= 20 and (not farmCooldown[p] or tick() - farmCooldown[p] > 2) then
                rootPart.CFrame = p.Parent.CFrame * CFrame.new(0,0,-4)
                fireproximityprompt(p)
                farmCooldown[p] = tick()
                stats.farms += 1
            end
        end
    end
    -- Exits smart TP
    for _, z in pairs(workspace:GetChildren()) do
        if (z.Name:find("Exit") or z.Name:find("Portal") or z:FindFirstChild("ExitZone")) and rootPart then
            local dist = (rootPart.Position - z:GetPivot().Position).Magnitude
            if dist <= 100 then
                rootPart.CFrame = z:GetPivot().CFrame + Vector3.new(0,5,0)
            end
        end
    end
end

local abilities = {"tornado", "dash", "heal"}
local function autoAbility()
    if not toggles.ability then return end
    local char = getChar()
    if not char then return end
    pcall(function()
        local ab = abilities[math.random(1, #abilities)]
        rs.remotes.useAbility:FireServer(ab)
    end)
end

local function autoDodge()
    if not toggles.dodge then return end
    local char = getChar()
    if not char or humanoid.Health == math.huge then return end
    if humanoid.Health < humanoid.MaxHealth * 0.6 then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        rs.remotes.useAbility:FireServer("dash")
    end
end

local function toggleFly()
    toggles.fly = not toggles.fly
    if toggles.fly and rootPart then
        flyVel = Instance.new("BodyVelocity")
        flyVel.MaxForce = Vector3.new(4000,4000,4000)
        flyVel.Parent = rootPart
    elseif flyVel then
        flyVel:Destroy()
        flyVel = nil
    end
end

local function updateFly()
    if not toggles.fly or not flyVel or not rootPart then return end
    local cam = workspace.CurrentCamera
    local vel = Vector3.new(0,0,0)
    if uis:IsKeyDown(Enum.KeyCode.W) then vel += cam.CFrame.LookVector * 50 end
    if uis:IsKeyDown(Enum.KeyCode.S) then vel -= cam.CFrame.LookVector * 50 end
    if uis:IsKeyDown(Enum.KeyCode.A) then vel -= cam.CFrame.RightVector * 50 end
    if uis:IsKeyDown(Enum.KeyCode.D) then vel += cam.CFrame.RightVector * 50 end
    if uis:IsKeyDown(Enum.KeyCode.Space) then vel += Vector3.new(0,50,0) end
    if uis:IsKeyDown(Enum.KeyCode.LeftShift) then vel -= Vector3.new(0,50,0) end
    flyVel.Velocity = vel
end

local function cleanUI()
    local pgui = player.PlayerGui
    if pgui:FindFirstChild("gameUI") then
        for _, f in pairs(pgui.gameUI:GetDescendants()) do
            if f.Name:lower():find("upgrade") or f.Name:lower():find("shop") then
                f.Visible = false
            end
        end
    end
    for _, e in pairs(game.Lighting:GetChildren()) do
        if e:IsA("BlurEffect") or e.Name:lower():find("death") then e:Destroy() end
    end
end

-- Main Loop (Optimized 15Hz, no spam)
run.Heartbeat:Connect(function()
    pcall(applyGod)
    pcall(killAura)
    pcall(autoFarm)
    pcall(autoAbility)
    pcall(autoDodge)
    pcall(updateFly)
end)

-- Infinite Jump
run.Heartbeat:Connect(function()
    if toggles.speed and humanoid and humanoid:GetState() == Enum.HumanoidStateType.Landed then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- Init
task.wait(1)
getChar()
cleanUI()
applyGod()
log("Pablo OP Hub carregado | F1: Toggle Panel")

-- Keys (backup)
uis.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.F1 then
        panelVisible = not panelVisible
        mainFrame.Visible = panelVisible
    elseif input.KeyCode == Enum.KeyCode.F2 then
        toggles.aura = not toggles.aura
        log("Aura: " .. (toggles.aura and "ON" or "OFF"))
    elseif input.KeyCode == Enum.KeyCode.F3 then
        toggleFly()
    elseif input.KeyCode == Enum.KeyCode.F4 then
        toggles.farm = not toggles.farm
        log("Farm: " .. (toggles.farm and "ON" or "OFF"))
    end
end)

player.CharacterAdded:Connect(function()
    task.wait(0.5)
    getChar()
    applyGod()
    cleanUI()
end)

-- Stats
task.spawn(function()
    while true do
        task.wait(20)
        log("Stats | Kills: " .. stats.kills .. " | Farms: " .. stats.farms)
    end
end)

log("GUI ativa. Ative Farm manualmente. Teste privado, Pablo! ⚔️")
