local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
   Name = "Pablo OP - Pixel Blade (Corrigido)",
   LoadingTitle = "Carregando Pablo OP...",
   LoadingSubtitle = "Mata tudo sem se mexer + Avan√ßa r√°pido",
   ConfigurationSaving = {Enabled = false},
   Discord = {Enabled = false},
   KeySystem = false
})

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local Player = Players.LocalPlayer
local remotes = ReplicatedStorage:WaitForChild("remotes")

-- Remotes confirmados e corrigidos
local useAbilityRemote = remotes:WaitForChild("useAbility")
local abilityHitRemote = remotes:WaitForChild("abilityHit")

local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

local KillAura = false
local AutoFarm = false
local NoClipEnabled = false  -- Sempre ligado no AutoFarm
local InfiniteJump = false
local MobESP = false
local VisibleHitbox = false
local Fullbright = false

local AuraRange = 999  -- N√£o precisa, mas mantido
local WalkSpeedVal = 16
local JumpPowerVal = 50

local NoClipConn, EspHighlights, HitboxParts = nil, {}, {}

Player.CharacterAdded:Connect(function(c)
   Character = c
   Humanoid = c:WaitForChild("Humanoid")
   RootPart = c:WaitForChild("HumanoidRootPart")
   Humanoid.WalkSpeed = WalkSpeedVal
   Humanoid.JumpPower = JumpPowerVal
   if NoClipEnabled then ToggleNoClip(true) end
end)

local function IsValidEnemy(obj)
   if not obj:IsA("Model") then return false end
   local hum = obj:FindFirstChild("Humanoid") or (obj:FindFirstChildWhichIsA("Model") and obj:FindFirstChildWhichIsA("Model"):FindFirstChild("Humanoid"))
   if not hum then return false end
   if hum.Health <= 0 then return false end
   if Players:GetPlayerFromCharacter(obj) then return false end
   -- Filtros exatos do jogo: ignora armadilhas/plants etc.
   local name = obj.Name:lower()
   if name:find("plant") or name:find("trap") or name:find("spike") or name:find("vine") or name:find("dummy") then return false end
   -- Valida√ß√£o chave: hadEntrance + Health
   if not obj:GetAttribute("hadEntrance") or not obj:FindFirstChild("Health") then return false end
   return true
end

local function ToggleNoClip(state)
   NoClipEnabled = state
   if NoClipConn then NoClipConn:Disconnect() NoClipConn = nil end
   if state then
      NoClipConn = RunService.Stepped:Connect(function()
         if Character then
            for _, p in ipairs(Character:GetDescendants()) do
               if p:IsA("BasePart") and p ~= RootPart then p.CanCollide = false end
            end
         end
      end)
   end
end

UserInputService.JumpRequest:Connect(function()
   if InfiniteJump and Humanoid then
      Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
   end
end)

-- Flag para avan√ßar rooms
local roomcheck = false

local function AdvanceRoom()
   -- Ativa todos ProximityPrompts (portais, portas)
   for _, v in ipairs(Workspace:GetDescendants()) do
      if v:IsA("ProximityPrompt") and v.Enabled then
         RootPart.CFrame = v.Parent.CFrame
         fireproximityprompt(v)
         task.wait(0.05)
      end
   end
   -- Vai para ExitZone
   for _, v in ipairs(Workspace:GetChildren()) do
      if v:FindFirstChild("ExitZone") then
         RootPart.CFrame = v.ExitZone.CFrame
         task.wait(0.2)
         RootPart.CFrame = CFrame.new(v:GetPivot().Position)
         task.wait(0.2)
         break
      end
   end
   roomcheck = false
end

-- Loop principal ULTRA R√ÅPIDO (RenderStepped)
RunService.RenderStepped:Connect(function()
   if not Character or not RootPart or not Humanoid or Humanoid.Health <= 0 then return end
   
   -- NoClip sempre no AutoFarm
   if AutoFarm then ToggleNoClip(true) end
   
   -- Mata TODOS os mobs no Workspace (sem teleportar!)
   if KillAura or AutoFarm then
      useAbilityRemote:FireServer("tornado")  -- Ativa ability de √°rea
      for _, obj in ipairs(Workspace:GetChildren()) do
         if IsValidEnemy(obj) then
            local hum = obj:FindFirstChild("Humanoid") or (obj:FindFirstChildWhichIsA("Model") and obj:FindFirstChildWhichIsA("Model"):FindFirstChild("Humanoid"))
            if hum then
               -- Hit corrigido: 3 args exatos, math.huge dano + stun
               abilityHitRemote:FireServer(hum, math.huge, {["stun"] = {["dur"] = 1}})
            end
         end
      end
   end
   
   -- Avan√ßa room automaticamente
   if AutoFarm and not roomcheck then
      roomcheck = true
      task.spawn(AdvanceRoom)
   end
end)

Workspace.ChildAdded:Connect(function()
   task.wait(0.1)
end)

-- ESP e Hitbox (otimizados)
local function ToggleMobESP(state)
   MobESP = state
   for _, h in ipairs(EspHighlights) do h:Destroy() end
   EspHighlights = {}
   if state then
      RunService.Heartbeat:Connect(function()
         if not MobESP then return end
         for _, obj in ipairs(Workspace:GetChildren()) do
            if IsValidEnemy(obj) and not obj:FindFirstChild("ESPHighlight") then
               local hl = Instance.new("Highlight")
               hl.Name = "ESPHighlight"
               hl.FillTransparency = 0.5
               hl.OutlineColor = Color3.fromRGB(255, 0, 0)
               hl.FillColor = Color3.fromRGB(255, 0, 0)
               hl.Parent = obj
               table.insert(EspHighlights, hl)
            end
         end
      end)
   end
end

local function ToggleVisibleHitbox(state)
   VisibleHitbox = state
   for _, b in ipairs(HitboxParts) do b:Destroy() end
   HitboxParts = {}
   if state then
      RunService.Heartbeat:Connect(function()
         if not VisibleHitbox then return end
         for _, obj in ipairs(Workspace:GetChildren()) do
            if IsValidEnemy(obj) then
               local hrp = obj:FindFirstChild("HumanoidRootPart")
               if hrp and not hrp:FindFirstChild("HitboxVisual") then
                  local box = Instance.new("BoxHandleAdornment")
                  box.Name = "HitboxVisual"
                  box.Adornee = hrp
                  box.Size = Vector3.new(6, 9, 6)
                  box.AlwaysOnTop = true
                  box.Transparency = 0.5
                  box.Color3 = Color3.fromRGB(255, 0, 0)
                  box.Parent = hrp
                  table.insert(HitboxParts, box)
               end
            end
         end
      end)
   end
end

local function ToggleFullbright(state)
   Fullbright = state
   if state then
      Lighting.Brightness = 3
      Lighting.ClockTime = 14
      Lighting.FogEnd = 9e9
      Lighting.GlobalShadows = false
   else
      Lighting.Brightness = 1
      Lighting.ClockTime = 0
      Lighting.FogEnd = 100
      Lighting.GlobalShadows = true
   end
end

-- Interface
local FarmTab = Window:CreateTab("Auto Farm")
local MoveTab = Window:CreateTab("Movement")
local VisualTab = Window:CreateTab("Visual")

FarmTab:CreateToggle({Name = "Kill Aura (Mata Tudo)", Callback = function(v) KillAura = v end})
FarmTab:CreateToggle({Name = "Auto Farm (Mata + Avan√ßa + NoClip)", Callback = function(v) AutoFarm = v end})

MoveTab:CreateToggle({Name = "Noclip (Sempre)", Callback = function(v) ToggleNoClip(v) end})
MoveTab:CreateToggle({Name = "Infinite Jump", Callback = function(v) InfiniteJump = v end})
MoveTab:CreateSlider({Name = "Walk Speed", Range = {16, 300}, CurrentValue = 16, Callback = function(v) WalkSpeedVal = v if Humanoid then Humanoid.WalkSpeed = v end end})
MoveTab:CreateSlider({Name = "Jump Power", Range = {50, 400}, CurrentValue = 50, Callback = function(v) JumpPowerVal = v if Humanoid then Humanoid.JumpPower = v end end})

VisualTab:CreateToggle({Name = "Mob ESP", Callback = ToggleMobESP})
VisualTab:CreateToggle({Name = "Visible Hitbox", Callback = ToggleVisibleHitbox})
VisualTab:CreateToggle({Name = "Fullbright", Callback = ToggleFullbright})

Rayfield:Notify({
   Title = "Pablo OP Corrigido!",
   Content = "Agora mata TUDO sem se mexer (sem voar baixo/deitado), NoClip auto, pula armadilhas e avan√ßa SUPER R√ÅPIDO!",
   Duration = 10
})

print("Pablo OP - MATANDO TUDO SEM MORRER! üöÄ")
