local player = game.Players.LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local uis = game:GetService("UserInputService")
local run = game:GetService("RunService")
local ts = game:GetService("TweenService")

local tweenSmooth = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
local tweenHover = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

local toggles = {
    killAura = false,
    highRange = false,
    autoFarm = false,
    autoCollect = false,
    fly = false,
    noclip = false,
    infiniteJump = false,
    removeSwordDelay = false,
    mobESP = false
}

local configs = {
    auraRange = 80,
    highRangeMultiplier = 2,
    flySpeed = 50,
    speedVal = 16,
    speedMax = 100,
    debounceAura = 0.05,
    debounceFarm = 0.4
}

local stats = {kills = 0, farms = 0}
local rootPart = nil
local humanoid = nil
local originalSpeed = nil
local originalJump = nil
local gui = nil
local mainFrame = nil
local panelVisible = true
local guiLoaded = false

local function safeLog(msg)
    print("[Pablo OP] " .. msg)
end

local function getCharSafe()
    local char = player.Character
    if not char then return false end
    rootPart = char:FindFirstChild("HumanoidRootPart")
    humanoid = char:FindFirstChild("Humanoid")
    if rootPart and humanoid then
        if not originalSpeed then
            originalSpeed = humanoid.WalkSpeed
            originalJump = humanoid.JumpPower
        end
        return true
    end
    return false
end

local function fullReset()
    if humanoid then
        humanoid.WalkSpeed = originalSpeed or 16
        humanoid.JumpPower = originalJump or 50
    end
end

local function createGUI()
    if guiLoaded then return end
    
    gui = Instance.new("ScreenGui")
    gui.Name = "PabloOP"
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    gui.DisplayOrder = 9999
    gui.Enabled = true
    gui.Parent = player:WaitForChild("PlayerGui", 10)
    
    mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 340, 0, 280)  -- Largura maior, altura menor (minimalista)
    mainFrame.Position = UDim2.new(1, -360, 0.3, 0)  -- Direita da tela, centralizado verticalmente
    mainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 20)
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = true
    mainFrame.Parent = gui
    
    local grad = Instance.new("UIGradient")
    grad.Color = ColorSequence.new(Color3.fromRGB(10,10,20), Color3.fromRGB(20,25,40))
    grad.Rotation = 90
    grad.Parent = mainFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 16)
    corner.Parent = mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 120, 255)
    stroke.Thickness = 1.5
    stroke.Transparency = 0.3
    stroke.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1,0,0,40)
    title.BackgroundTransparency = 1
    title.Text = "Pablo OP"
    title.TextColor3 = Color3.fromRGB(0, 180, 255)
    title.TextSize = 20
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0,30,0,30)
    closeBtn.Position = UDim2.new(1,-35,0,5)
    closeBtn.BackgroundColor3 = Color3.fromRGB(40,40,60)
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255,80,80)
    closeBtn.TextSize = 18
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = mainFrame
    
    local cornerClose = Instance.new("UICorner")
    cornerClose.CornerRadius = UDim.new(0,12)
    cornerClose.Parent = closeBtn
    
    local minBtn = Instance.new("TextButton")
    minBtn.Size = UDim2.new(0,30,0,30)
    minBtn.Position = UDim2.new(1,-70,0,5)
    minBtn.BackgroundColor3 = Color3.fromRGB(40,40,60)
    minBtn.Text = "↕"
    minBtn.TextColor3 = Color3.fromRGB(200,220,255)
    minBtn.TextSize = 18
    minBtn.Font = Enum.Font.Gotham
    minBtn.Parent = mainFrame
    
    local cornerMin = Instance.new("UICorner")
    cornerMin.CornerRadius = UDim.new(0,12)
    cornerMin.Parent = minBtn
    
    -- Auto Farm Section
    local autoFarmSec = Instance.new("Frame")
    autoFarmSec.Size = UDim2.new(0.48, -10, 0.9, -50)
    autoFarmSec.Position = UDim2.new(0.01, 5, 0.12, 0)
    autoFarmSec.BackgroundColor3 = Color3.fromRGB(18,22,35)
    autoFarmSec.Parent = mainFrame
    
    local cornerAF = Instance.new("UICorner")
    cornerAF.CornerRadius = UDim.new(0,12)
    cornerAF.Parent = autoFarmSec
    
    local afTitle = Instance.new("TextLabel")
    afTitle.Size = UDim2.new(1,0,0,35)
    afTitle.BackgroundTransparency = 1
    afTitle.Text = "Auto Farm"
    afTitle.TextColor3 = Color3.fromRGB(100,200,255)
    afTitle.TextSize = 18
    afTitle.Font = Enum.Font.GothamBold
    afTitle.Parent = autoFarmSec
    
    -- Movement Section
    local movementSec = Instance.new("Frame")
    movementSec.Size = UDim2.new(0.48, -10, 0.9, -50)
    movementSec.Position = UDim2.new(0.51, 5, 0.12, 0)
    movementSec.BackgroundColor3 = Color3.fromRGB(18,22,35)
    movementSec.Parent = mainFrame
    
    local cornerM = Instance.new("UICorner")
    cornerM.CornerRadius = UDim.new(0,12)
    cornerM.Parent = movementSec
    
    local mTitle = Instance.new("TextLabel")
    mTitle.Size = UDim2.new(1,0,0,35)
    mTitle.BackgroundTransparency = 1
    mTitle.Text = "Movement"
    mTitle.TextColor3 = Color3.fromRGB(100,200,255)
    mTitle.TextSize = 18
    mTitle.Font = Enum.Font.GothamBold
    mTitle.Parent = movementSec
    
    -- Visual Section
    local visualSec = Instance.new("Frame")
    visualSec.Size = UDim2.new(0.48, -10, 0.9, -50)
    visualSec.Position = UDim2.new(0.01, 5, 0.5, 0)
    visualSec.BackgroundColor3 = Color3.fromRGB(18,22,35)
    visualSec.Parent = mainFrame
    
    local cornerV = Instance.new("UICorner")
    cornerV.CornerRadius = UDim.new(0,12)
    cornerV.Parent = visualSec
    
    local vTitle = Instance.new("TextLabel")
    vTitle.Size = UDim2.new(1,0,0,35)
    vTitle.BackgroundTransparency = 1
    vTitle.Text = "Visual"
    vTitle.TextColor3 = Color3.fromRGB(100,200,255)
    vTitle.TextSize = 18
    vTitle.Font = Enum.Font.GothamBold
    vTitle.Parent = visualSec
    
    -- Toggle Function
    local function createToggle(parent, name, yPos, label)
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1,-20,0,40)
        frame.Position = UDim2.new(0,10,0,yPos)
        frame.BackgroundTransparency = 1
        frame.Parent = parent
        
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(0.7,0,1,0)
        lbl.BackgroundTransparency = 1
        lbl.Text = label
        lbl.TextColor3 = Color3.fromRGB(200,220,255)
        lbl.TextSize = 16
        lbl.Font = Enum.Font.GothamSemibold
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.Parent = frame
        
        local pill = Instance.new("Frame")
        pill.Size = UDim2.new(0,50,0,24)
        pill.Position = UDim2.new(1,-60,0.5,-12)
        pill.BackgroundColor3 = toggles[name] and Color3.fromRGB(0,190,90) or Color3.fromRGB(80,80,90)
        pill.Parent = frame
        
        local cornerPill = Instance.new("UICorner")
        cornerPill.CornerRadius = UDim.new(0,12)
        cornerPill.Parent = pill
        
        local knob = Instance.new("Frame")
        knob.Size = UDim2.new(0,22,0,22)
        knob.Position = UDim2.new(toggles[name] and 0.58,0,0.5,-11)
        knob.BackgroundColor3 = Color3.new(1,1,1)
        knob.Parent = pill
        
        local cornerKnob = Instance.new("UICorner")
        cornerKnob.CornerRadius = UDim.new(1,0)
        cornerKnob.Parent = knob
        
        pill.MouseButton1Click:Connect(function()
            toggles[name] = not toggles[name]
            ts:Create(pill, tweenSmooth, {BackgroundColor3 = toggles[name] and Color3.fromRGB(0,190,90) or Color3.fromRGB(80,80,90)}):Play()
            ts:Create(knob, tweenSmooth, {Position = UDim2.new(toggles[name] and 0.58,0,0.5,-11)}):Play()
        end)
    end
    
    -- Auto Farm Toggles
    createToggle(autoFarmSec, "killAura", 40, "Kill Aura")
    createToggle(autoFarmSec, "highRange", 85, "High Range Aura")
    createToggle(autoFarmSec, "autoFarm", 130, "Auto Farm")
    
    -- Movement Toggles
    createToggle(movementSec, "fly", 40, "Fly")
    createToggle(movementSec, "noclip", 85, "Noclip")
    createToggle(movementSec, "infiniteJump", 130, "Infinite Jump")
    
    -- Visual Toggles
    createToggle(visualSec, "removeSwordDelay", 40, "No Sword Delay")
    createToggle(visualSec, "mobESP", 85, "Mob ESP")
    
    -- Drag
    local drag = {dragging = false, start = nil, mouse = nil}
    title.InputBegan:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 then
            drag.dragging = true
            drag.start = mainFrame.Position
            drag.mouse = inp.Position
        end
    end)
    uis.InputChanged:Connect(function(inp)
        if drag.dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = inp.Position - drag.mouse
            mainFrame.Position = UDim2.new(drag.start.X.Scale, drag.start.X.Offset + delta.X, drag.start.Y.Scale, drag.start.Y.Offset + delta.Y)
        end
    end)
    uis.InputEnded:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 then drag.dragging = false end
    end)
    
    -- Minimize/Open
    minBtn.MouseButton1Click:Connect(function()
        panelVisible = not panelVisible
        mainFrame.Visible = panelVisible
    end)
    
    -- Close/Show
    closeBtn.MouseButton1Click:Connect(function()
        panelVisible = not panelVisible
        mainFrame.Visible = panelVisible
    end)
    
    setZIndexRecursive(mainFrame, configs.guiZIndex)
    guiLoaded = true
    safeLog("GUI v10 loaded - Right-aligned, minimal, sections with options")
end

-- Features
local function killAura()
    if not toggles.killAura then return end
    if not getCharSafe() then return end
    local range = toggles.highRange and configs.auraRange * configs.highRangeMultiplier or configs.auraRange
    local now = tick()
    if now - cooldowns.aura < configs.debounceAura then return end
    cooldowns.aura = now
    
    for _, obj in pairs(workspace:GetChildren()) do
        local hum = obj:FindFirstChildOfClass("Humanoid")
        local hrp = obj:FindFirstChild("HumanoidRootPart") or obj.PrimaryPart
        if hum and hrp and hum.Health > 0 and obj ~= player.Character and (rootPart.Position - hrp.Position).Magnitude <= range then
            pcall(function()
                for _, ab in pairs(configs.auraAbilities) do
                    rs.remotes.useAbility:FireServer(ab)
                end
                rs.remotes.abilityHit:FireServer(hum, math.huge, {stun = {dur = math.huge}})
            end)
            stats.kills = stats.kills + 1
        end
    end
end

local function farmAuto()
    if not toggles.autoFarm then return end
    if not getCharSafe() then return end
    local now = tick()
    if now - cooldowns.farm.global < configs.debounceFarm then return end
    cooldowns.farm.global = now
    
    for _, p in pairs(workspace:GetDescendants()) do
        if p:IsA("ProximityPrompt") and p.Enabled then
            local pos = p.Parent.Position
            local dist = (rootPart.Position - pos).Magnitude
            if dist <= configs.farmDist then
                rootPart.CFrame = CFrame.new(pos + Vector3.new(0, configs.farmHeight, -4), pos)
                fireproximityprompt(p)
                stats.farms = stats.farms + 1
            end
        end
    end
end

local function applySpeed()
    if not toggles.speed then 
        fullReset()
        return 
    end
    if not getCharSafe() then return end
    humanoid.WalkSpeed = configs.speedVal
end

run.Heartbeat:Connect(function()
    if toggles.killAura then pcall(killAura) end
    if toggles.autoFarm then pcall(farmAuto) end
    if toggles.speed then pcall(applySpeed) end
end)

task.spawn(function()
    task.wait(3)
    createGUI()
    fullReset()
    safeLog("v10 loaded - Panel right-aligned, minimal, sections with options")
end)

safeLog("v10 ready - Click ↕ to minimize/open, X to hide/show")
