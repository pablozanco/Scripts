local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
   Name = "Pablo OP - PixelBlade",
   LoadingTitle = "Carregando",
   LoadingSubtitle = "Auto Farm Eficiente",
   KeySystem = false
})

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local Player = Players.LocalPlayer
local Character, Humanoid, RootPart

local Remotes = ReplicatedStorage:WaitForChild("remotes")
local onHitRemote = Remotes:WaitForChild("onHit")

local AutoFarm = false
local KillAura = false
local FlyEnabled = false
local NoClipEnabled = false
local InfiniteJump = false
local MobESP = false
local VisibleHitbox = false

local AuraRange = 350
local FlySpeed = 80
local WalkSpeedVal = 16
local JumpPowerVal = 50
local HoverHeight = 12
local HitDelay = 0.22

local BV, BG
local AlignPos, AlignOri
local NoClipConn
local EspList, HitboxList = {}, {}
local CurrentTarget = nil

local function UpdateChar()
   Character = Player.Character or Player.CharacterAdded:Wait()
   Humanoid = Character:WaitForChild("Humanoid")
   RootPart = Character:WaitForChild("HumanoidRootPart")

   Humanoid.WalkSpeed = WalkSpeedVal
   Humanoid.JumpPower = JumpPowerVal

   for _, s in ipairs(Enum.HumanoidStateType:GetEnumItems()) do
      Humanoid:SetStateEnabled(s, true)
   end
end

UpdateChar()
Player.CharacterAdded:Connect(UpdateChar)

local function IsValidEnemy(obj)
   local hum = obj:FindFirstChild("Humanoid")
   local hrp = obj:FindFirstChild("HumanoidRootPart")
   if not hum or not hrp then return false end
   if hum.Health <= 0 then return false end
   if hum.MaxHealth <= 5 then return false end
   if hrp.Anchored then return false end
   if hrp.Size.Y < 3 then return false end
   if Players:GetPlayerFromCharacter(obj) then return false end
   return true
end

local function GetEnemies()
   local list = {}
   for _, obj in ipairs(Workspace:GetChildren()) do
      if IsValidEnemy(obj) then
         local dist = (RootPart.Position - obj.HumanoidRootPart.Position).Magnitude
         if dist <= AuraRange then
            table.insert(list, {hum = obj.Humanoid, hrp = obj.HumanoidRootPart})
         end
      end
   end
   return list
end

local function EnableHover(targetHRP)
   AlignPos = Instance.new("AlignPosition", RootPart)
   AlignPos.MaxForce = 1e9
   AlignPos.Responsiveness = 300

   AlignOri = Instance.new("AlignOrientation", RootPart)
   AlignOri.MaxTorque = 1e9
   AlignOri.Responsiveness = 300

   local a0 = Instance.new("Attachment", RootPart)
   local a1 = Instance.new("Attachment", targetHRP)

   AlignPos.Attachment0 = a0
   AlignPos.Attachment1 = a1
   AlignPos.Position = Vector3.new(0, HoverHeight, 0)

   AlignOri.Attachment0 = a0
   AlignOri.Attachment1 = a1
end

local function DisableHover()
   if AlignPos then AlignPos:Destroy() AlignPos = nil end
   if AlignOri then AlignOri:Destroy() AlignOri = nil end
   if Humanoid then
      for _, s in ipairs(Enum.HumanoidStateType:GetEnumItems()) do
         Humanoid:SetStateEnabled(s, true)
      end
      Humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
   end
end

task.spawn(function()
   while task.wait(HitDelay) do
      if not AutoFarm then
         DisableHover()
         CurrentTarget = nil
         continue
      end

      local enemies = GetEnemies()
      if #enemies > 0 then
         local target = enemies[1]
         if CurrentTarget ~= target then
            DisableHover()
            EnableHover(target.hrp)
            CurrentTarget = target
         end
         onHitRemote:FireServer(target.hum, 9999999, {}, 0)
      else
         DisableHover()
         CurrentTarget = nil
      end
   end
end)

task.spawn(function()
   while task.wait(0.35) do
      if KillAura then
         for _, e in ipairs(GetEnemies()) do
            onHitRemote:FireServer(e.hum, 9999999, {}, 0)
         end
      end
   end
end)

local function ToggleNoClip(state)
   if NoClipConn then NoClipConn:Disconnect() end
   if state then
      NoClipConn = RunService.Stepped:Connect(function()
         for _, p in ipairs(Character:GetDescendants()) do
            if p:IsA("BasePart") then p.CanCollide = false end
         end
      end)
   end
end

local function ToggleFly(state)
   FlyEnabled = state
   if not state then
      if BV then BV:Destroy() end
      if BG then BG:Destroy() end
      return
   end

   BV = Instance.new("BodyVelocity", RootPart)
   BV.MaxForce = Vector3.new(1e9,1e9,1e9)

   BG = Instance.new("BodyGyro", RootPart)
   BG.MaxTorque = Vector3.new(1e9,1e9,1e9)
   BG.P = 9e4

   RunService.RenderStepped:Connect(function()
      if not FlyEnabled then return end
      local cam = workspace.CurrentCamera
      local move = Vector3.zero

      if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += cam.CFrame.LookVector end
      if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= cam.CFrame.LookVector end
      if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= cam.CFrame.RightVector end
      if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += cam.CFrame.RightVector end
      if UserInputService:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0,1,0) end

      BV.Velocity = move.Magnitude > 0 and move.Unit * FlySpeed or Vector3.zero
      BG.CFrame = cam.CFrame
   end)
end

UserInputService.JumpRequest:Connect(function()
   if InfiniteJump then
      Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
   end
end)

local function ToggleMobESP(state)
   for _, e in ipairs(EspList) do e:Destroy() end
   EspList = {}
   if state then
      RunService.Heartbeat:Connect(function()
         if not state then return end
         for _, obj in ipairs(Workspace:GetChildren()) do
            if IsValidEnemy(obj) and not obj:FindFirstChild("ESP") then
               local h = Instance.new("Highlight")
               h.Name = "ESP"
               h.FillTransparency = 0.8
               h.OutlineColor = Color3.fromRGB(255,0,0)
               h.Parent = obj
               table.insert(EspList, h)
            end
         end
      end)
   end
end

local function ToggleVisibleHitbox(state)
   for _, h in ipairs(HitboxList) do h:Destroy() end
   HitboxList = {}
   if state then
      RunService.Heartbeat:Connect(function()
         if not state then return end
         for _, obj in ipairs(Workspace:GetChildren()) do
            if IsValidEnemy(obj) then
               local hrp = obj.HumanoidRootPart
               if not hrp:FindFirstChild("Hitbox") then
                  local b = Instance.new("BoxHandleAdornment")
                  b.Name = "Hitbox"
                  b.Size = Vector3.new(4,6,4)
                  b.Transparency = 0.7
                  b.AlwaysOnTop = true
                  b.Adornee = hrp
                  b.Parent = hrp
                  table.insert(HitboxList, b)
               end
            end
         end
      end)
   end
end

local function ToggleFullbright(state)
   if state then
      Lighting.Brightness = 2
      Lighting.ClockTime = 14
      Lighting.FogEnd = 1e9
      Lighting.GlobalShadows = false
   else
      Lighting.Brightness = 1
      Lighting.ClockTime = 0
      Lighting.FogEnd = 100
      Lighting.GlobalShadows = true
   end
end

local FarmTab = Window:CreateTab("Auto Farm")
local MoveTab = Window:CreateTab("Movement")
local VisualTab = Window:CreateTab("Visual")

FarmTab:CreateToggle({Name="Auto Farm", Callback=function(v) AutoFarm=v end})
FarmTab:CreateToggle({Name="Kill Aura", Callback=function(v) KillAura=v end})

MoveTab:CreateToggle({Name="Fly", Callback=ToggleFly})
MoveTab:CreateToggle({Name="Noclip", Callback=ToggleNoClip})
MoveTab:CreateToggle({Name="Infinite Jump", Callback=function(v) InfiniteJump=v end})
MoveTab:CreateSlider({Name="Walk Speed", Range={16,200}, Increment=5, CurrentValue=16,
   Callback=function(v) WalkSpeedVal=v Humanoid.WalkSpeed=v end})
MoveTab:CreateSlider({Name="Jump Power", Range={50,300}, Increment=10, CurrentValue=50,
   Callback=function(v) JumpPowerVal=v Humanoid.JumpPower=v end})

VisualTab:CreateToggle({Name="Mob ESP", Callback=ToggleMobESP})
VisualTab:CreateToggle({Name="Visible Hitbox", Callback=ToggleVisibleHitbox})
VisualTab:CreateToggle({Name="Fullbright", Callback=ToggleFullbright})

Rayfield:Notify({
   Title="Pablo OP",
   Content="Auto Farm otimizado contra armadilhas do Carmesin",
   Duration=6
})
