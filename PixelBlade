-- SERVIÇOS
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local Player = Players.LocalPlayer
local Character, Humanoid, RootPart

local remotes = ReplicatedStorage:WaitForChild("remotes")
local onHitRemote = remotes:WaitForChild("onHit")

-- VARIÁVEIS
local AutoFarm = false
local KillAura = false
local FlyEnabled = false
local InfiniteJump = false

local AuraRange = 300
local FlySpeed = 80
local FarmHeight = 15

-- ATUALIZA PERSONAGEM
local function UpdateChar()
    Character = Player.Character or Player.CharacterAdded:Wait()
    Humanoid = Character:WaitForChild("Humanoid")
    RootPart = Character:WaitForChild("HumanoidRootPart")
end
UpdateChar()
Player.CharacterAdded:Connect(UpdateChar)

-- GET MOBS (OTIMIZADO)
local function GetClosestMob()
    local closest, dist = nil, math.huge
    for _, obj in ipairs(Workspace:GetChildren()) do
        local hum = obj:FindFirstChild("Humanoid")
        local hrp = obj:FindFirstChild("HumanoidRootPart")
        if hum and hrp and hum.Health > 0 and not Players:GetPlayerFromCharacter(obj) then
            local d = (RootPart.Position - hrp.Position).Magnitude
            if d < dist and d <= AuraRange then
                dist = d
                closest = obj
            end
        end
    end
    return closest
end

-- FLY REAL
local BV, BG
local function ToggleFly(state)
    FlyEnabled = state
    if not state then
        if BV then BV:Destroy() end
        if BG then BG:Destroy() end
        return
    end

    BV = Instance.new("BodyVelocity", RootPart)
    BV.MaxForce = Vector3.new(1e9,1e9,1e9)

    BG = Instance.new("BodyGyro", RootPart)
    BG.MaxTorque = Vector3.new(1e9,1e9,1e9)
    BG.P = 9e4

    RunService.RenderStepped:Connect(function()
        if not FlyEnabled then return end
        local cam = workspace.CurrentCamera
        local move = Vector3.zero

        if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += cam.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= cam.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= cam.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += cam.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0,1,0) end

        BV.Velocity = move.Unit * FlySpeed
        BG.CFrame = cam.CFrame
    end)
end

-- INFINITE JUMP
UserInputService.JumpRequest:Connect(function()
    if InfiniteJump then
        Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- AUTO FARM + KILL AURA (CONTROLADO)
task.spawn(function()
    while task.wait(0.15) do
        if not AutoFarm or not RootPart then continue end

        local mob = GetClosestMob()
        if mob then
            local hrp = mob.HumanoidRootPart
            RootPart.CFrame = CFrame.new(hrp.Position + Vector3.new(0, FarmHeight, 0))

            if KillAura then
                onHitRemote:FireServer(mob.Humanoid, 999999999, {}, 0)
            end
        end
    end
end)

-- UI (RAYFIELD)
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Pablo OP - Pixel Blade",
    LoadingTitle = "Carregando",
    LoadingSubtitle = "Auto Farm REAL",
    KeySystem = false
})

local FarmTab = Window:CreateTab("Farm")
local MoveTab = Window:CreateTab("Movement")

FarmTab:CreateToggle({
    Name = "Auto Farm",
    Callback = function(v) AutoFarm = v end
})

FarmTab:CreateToggle({
    Name = "Kill Aura",
    Callback = function(v) KillAura = v end
})

MoveTab:CreateToggle({
    Name = "Fly",
    Callback = ToggleFly
})

MoveTab:CreateToggle({
    Name = "Infinite Jump",
    Callback = function(v) InfiniteJump = v end
})

Rayfield:Notify({
    Title = "Pablo OP",
    Content = "Auto Farm agora voa, mata rápido e não buga",
    Duration = 6
})
