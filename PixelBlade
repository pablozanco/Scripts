local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
   Name = "Pablo OP - Pixel Blade (Corrigido 2026)",
   LoadingTitle = "Carregando Pablo OP...",
   LoadingSubtitle = "Kill Aura Remoto + Auto Farm Sem Mover",
   ConfigurationSaving = {Enabled = false},
   Discord = {Enabled = false},
   KeySystem = false
})

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local Player = Players.LocalPlayer
local remotes = ReplicatedStorage:WaitForChild("remotes")

local useAbility = remotes:WaitForChild("useAbility")
local abilityHit = remotes:WaitForChild("abilityHit")

local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

local KillAura = false
local AutoFarm = false
local NoClipEnabled = false
local InfiniteJump = false
local MobESP = false
local VisibleHitbox = false
local Fullbright = false

local EspHighlights = {}
local HitboxParts = {}
local NoClipConn

Player.CharacterAdded:Connect(function(newChar)
   Character = newChar
   Humanoid = newChar:WaitForChild("Humanoid")
   RootPart = newChar:WaitForChild("HumanoidRootPart")
   if NoClipEnabled then ToggleNoClip(true) end
end)

local function IsValidEnemy(model)
   if not model or not model:IsA("Model") then return false end
   
   local humanoid = model:FindFirstChildWhichIsA("Humanoid")
   if not humanoid or humanoid.Health <= 0 then return false end
   
   if Players:GetPlayerFromCharacter(model) then return false end
   
   local lowerName = model.Name:lower()
   if lowerName:find("plant") or lowerName:find("trap") or lowerName:find("spike") or 
      lowerName:find("vine") or lowerName:find("dummy") or lowerName:find("prop") then
      return false
   end
   
   -- Filtros comuns em Pixel Blade: monstros reais têm esses atributos/children
   if not model:GetAttribute("hadEntrance") and not model:FindFirstChild("Health") then
      return false
   end
   
   return true
end

local function ToggleNoClip(enable)
   NoClipEnabled = enable
   if NoClipConn then NoClipConn:Disconnect() end
   if enable then
      NoClipConn = RunService.Stepped:Connect(function()
         if Character then
            for _, part in ipairs(Character:GetDescendants()) do
               if part:IsA("BasePart") then
                  part.CanCollide = false
               end
            end
         end
      end)
   end
end

-- Kill Aura + Auto Farm em RenderStepped (muito rápido)
RunService.RenderStepped:Connect(function()
   if not Character or not RootPart or Humanoid.Health <= 0 then return end
   
   if AutoFarm then
      ToggleNoClip(true)  -- Sempre noClip no farm para não morrer
   end
   
   if KillAura or AutoFarm then
      -- Ativa ability de área (tornado é boa para multi-hit)
      useAbility:FireServer("tornado")
      
      -- Hit em TODOS os inimigos válidos (sem mover personagem!)
      for _, obj in ipairs(Workspace:GetChildren()) do
         if IsValidEnemy(obj) then
            local hum = obj:FindFirstChildWhichIsA("Humanoid")
            if hum then
               -- Argumentos comuns em scripts recentes: hum, damage, effects_table
               abilityHit:FireServer(hum, math.huge, {stun = {dur = 2}}, 0)
            end
         end
      end
   end
   
   -- Avança fase se não tiver mais inimigos
   if AutoFarm then
      local hasEnemy = false
      for _, obj in ipairs(Workspace:GetChildren()) do
         if IsValidEnemy(obj) then
            hasEnemy = true
            break
         end
      end
      
      if not hasEnemy then
         -- Procura portal/saída
         for _, obj in ipairs(Workspace:GetDescendants()) do
            if obj:IsA("ProximityPrompt") and obj.Enabled then
               local text = obj.ActionText:lower()
               if text:find("enter") or text:find("exit") or text:find("next") or text:find("portal") then
                  RootPart.CFrame = obj.Parent.CFrame + Vector3.new(0, 5, 0)
                  fireproximityprompt(obj)
                  task.wait(0.8)  -- Espera carregar próxima sala
                  break
               end
            end
         end
      end
   end
end)

-- ESP para mobs (opcional)
local function ToggleMobESP(state)
   MobESP = state
   for _, hl in ipairs(EspHighlights) do hl:Destroy() end
   EspHighlights = {}
   
   if state then
      RunService.Heartbeat:Connect(function()
         if not MobESP then return end
         for _, obj in ipairs(Workspace:GetChildren()) do
            if IsValidEnemy(obj) and not obj:FindFirstChild("ESP") then
               local highlight = Instance.new("Highlight")
               highlight.Name = "ESP"
               highlight.FillColor = Color3.fromRGB(255, 0, 0)
               highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
               highlight.FillTransparency = 0.6
               highlight.OutlineTransparency = 0
               highlight.Parent = obj
               table.insert(EspHighlights, highlight)
            end
         end
      end)
   end
end

-- Visible Hitbox (opcional)
local function ToggleVisibleHitbox(state)
   VisibleHitbox = state
   for _, box in ipairs(HitboxParts) do box:Destroy() end
   HitboxParts = {}
   
   if state then
      RunService.Heartbeat:Connect(function()
         if not VisibleHitbox then return end
         for _, obj in ipairs(Workspace:GetChildren()) do
            if IsValidEnemy(obj) then
               local hrp = obj:FindFirstChild("HumanoidRootPart")
               if hrp and not hrp:FindFirstChild("VisualBox") then
                  local adorn = Instance.new("BoxHandleAdornment")
                  adorn.Name = "VisualBox"
                  adorn.Adornee = hrp
                  adorn.Size = Vector3.new(8, 10, 8)
                  adorn.Transparency = 0.6
                  adorn.Color3 = Color3.fromRGB(255, 0, 0)
                  adorn.AlwaysOnTop = true
                  adorn.Parent = hrp
                  table.insert(HitboxParts, adorn)
               end
            end
         end
      end)
   end
end

local function ToggleFullbright(state)
   Fullbright = state
   if state then
      Lighting.Brightness = 3
      Lighting.ClockTime = 14
      Lighting.FogEnd = 999999
      Lighting.GlobalShadows = false
   else
      Lighting.Brightness = 1
      Lighting.ClockTime = 0
      Lighting.FogEnd = 100
      Lighting.GlobalShadows = true
   end
end

-- Tabs e toggles
local FarmTab = Window:CreateTab("Farm")
local VisualTab = Window:CreateTab("Visual")
local MoveTab = Window:CreateTab("Movement")

FarmTab:CreateToggle({
   Name = "Kill Aura (Auto Hit - Sem Clicar)",
   CurrentValue = false,
   Callback = function(Value)
      KillAura = Value
   end,
})

FarmTab:CreateToggle({
   Name = "Auto Farm (Mata + Avança Fases)",
   CurrentValue = false,
   Callback = function(Value)
      AutoFarm = Value
      if Value then KillAura = true end  -- Auto ativa kill aura
   end,
})

MoveTab:CreateToggle({
   Name = "NoClip (Segurança)",
   CurrentValue = false,
   Callback = function(Value)
      ToggleNoClip(Value)
   end,
})

MoveTab:CreateToggle({
   Name = "Infinite Jump",
   CurrentValue = false,
   Callback = function(Value)
      InfiniteJump = Value
   end,
})

VisualTab:CreateToggle({
   Name = "Mob ESP",
   CurrentValue = false,
   Callback = ToggleMobESP,
})

VisualTab:CreateToggle({
   Name = "Visible Hitbox",
   CurrentValue = false,
   Callback = ToggleVisibleHitbox,
})

VisualTab:CreateToggle({
   Name = "Fullbright",
   CurrentValue = false,
   Callback = ToggleFullbright,
})

Rayfield:Notify({
   Title = "Pablo OP Atualizado!",
   Content = "Kill Aura agora é 100% remoto (sem voar/deitar em cima). Mata tudo sozinho, sem clicar. Ative Auto Farm para farm infinito + avanço auto.",
   Duration = 8
})

print("Pablo OP - Kill Aura remoto ativado! Sem bugs de posição.")
