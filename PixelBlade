local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Pablo OP - Pixel Blade",
    LoadingTitle = "Carregando...",
    LoadingSubtitle = "Auto Farm preciso + estável",
    ConfigurationSaving = {Enabled = false},
    Discord = {Enabled = false},
    KeySystem = false
})

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local Player = Players.LocalPlayer
local remotes = ReplicatedStorage:WaitForChild("remotes")
local onHitRemote = remotes:WaitForChild("onHit")

local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

local KillAura = false
local AutoFarm = false
local FlyEnabled = false
local NoClipEnabled = false
local InfiniteJump = false
local MobESP = false
local VisibleHitbox = false
local Fullbright = false

local AuraRange = 300
local FlySpeed = 50
local WalkSpeedVal = 16
local JumpPowerVal = 50
local FarmHeightOffset = 25

local BV, FlyConn, NoClipConn
local EspHighlights = {}
local HitboxParts = {}

Player.CharacterAdded:Connect(function(c)
    Character = c
    Humanoid = c:WaitForChild("Humanoid")
    RootPart = c:WaitForChild("HumanoidRootPart")
    Humanoid.WalkSpeed = WalkSpeedVal
    Humanoid.JumpPower = JumpPowerVal
end)

local function IsTrap(mob)
    if not mob:FindFirstChild("HumanoidRootPart") then return true end
    if mob.Humanoid.MaxHealth <= 1 then return true end
    if mob.HumanoidRootPart.Anchored then return true end
    if (mob.HumanoidRootPart.Position.Y < RootPart.Position.Y - 10) then return true end
    return false
end

local function GetEnemies()
    local enemies = {}
    for _, obj in ipairs(Workspace:GetChildren()) do
        local hum = obj:FindFirstChild("Humanoid")
        local hrp = obj:FindFirstChild("HumanoidRootPart")
        if hum and hrp and hum.Health > 0 and obj ~= Character and not Players:GetPlayerFromCharacter(obj) then
            if not IsTrap(obj) then
                if (RootPart.Position - hrp.Position).Magnitude <= AuraRange then
                    table.insert(enemies, {hum = hum, hrp = hrp})
                end
            end
        end
    end
    return enemies
end

local function ToggleNoClip(v)
    NoClipEnabled = v
    if NoClipConn then NoClipConn:Disconnect() end
    if v then
        NoClipConn = RunService.Stepped:Connect(function()
            for _, p in ipairs(Character:GetDescendants()) do
                if p:IsA("BasePart") then p.CanCollide = false end
            end
        end)
    end
end

local function ToggleFly(v)
    FlyEnabled = v
    if BV then BV:Destroy() end
    if FlyConn then FlyConn:Disconnect() end
    if v then
        BV = Instance.new("BodyVelocity", RootPart)
        BV.MaxForce = Vector3.new(1e9,1e9,1e9)
        FlyConn = RunService.Heartbeat:Connect(function()
            local cam = workspace.CurrentCamera
            local dir = Vector3.zero
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.new(0,1,0) end
            BV.Velocity = dir * FlySpeed
        end)
    end
end

UserInputService.JumpRequest:Connect(function()
    if InfiniteJump then Humanoid:ChangeState(Enum.HumanoidStateType.Jumping) end
end)

RunService.Heartbeat:Connect(function()
    local enemies = GetEnemies()

    if KillAura then
        for _, e in ipairs(enemies) do
            onHitRemote:FireServer(e.hum, 9999999999, {}, 0)
        end
    end

    if AutoFarm and #enemies > 0 then
        local target = enemies[1]
        RootPart.CFrame = target.hrp.CFrame * CFrame.new(0, FarmHeightOffset, 0)
        task.wait()
        RootPart.CFrame = target.hrp.CFrame * CFrame.new(0, 3, 0)
        onHitRemote:FireServer(target.hum, 9999999999, {}, 0)
    end
end)

local FarmTab = Window:CreateTab("Auto Farm")
local MoveTab = Window:CreateTab("Movement")
local VisualTab = Window:CreateTab("Visual")

FarmTab:CreateToggle({Name="Kill Aura",CurrentValue=false,Callback=function(v)KillAura=v end})
FarmTab:CreateToggle({Name="Auto Farm",CurrentValue=false,Callback=function(v)AutoFarm=v end})

MoveTab:CreateToggle({Name="Fly",CurrentValue=false,Callback=ToggleFly})
MoveTab:CreateToggle({Name="Noclip",CurrentValue=false,Callback=ToggleNoClip})
MoveTab:CreateToggle({Name="Infinite Jump",CurrentValue=false,Callback=function(v)InfiniteJump=v end})

VisualTab:CreateToggle({Name="Fullbright",CurrentValue=false,Callback=function(v)
    Fullbright=v
    Lighting.Brightness = v and 2 or 1
    Lighting.FogEnd = v and 1e9 or 100
end})

Rayfield:Notify({
    Title = "Pablo OP",
    Content = "Auto Farm corrigido: bate voando, ignora armadilhas e não buga.",
    Duration = 6
})
